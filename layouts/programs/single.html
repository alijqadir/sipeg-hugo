{{ define "main" }}
<section class="section section--light">
  <div class="container">
    <article class="program-single">
      {{ $iconMap := dict "globe" "globe-hemisphere-east" "chart" "chart-line-up" "book" "book-open-text" "users" "users-three" "chip" "cpu" "compass" "compass" "sparkle" "sparkle" }}
      {{ $icon := .Params.icon | default "sparkle" }}
      {{ $icon := or (index $iconMap $icon) $icon }}
      <header class="program-single__header">
        <span class="icon-circle program-single__icon" aria-hidden="true">
          <i class="ph ph-{{ $icon }}"></i>
        </span>
        <div>
          <p class="eyebrow">Program</p>
          <h1>{{ .Title }}</h1>
          {{ with .Params.summary }}<p class="lead">{{ . }}</p>{{ end }}
        </div>
      </header>
      <div class="content">
        {{ .Content }}
      </div>
    </article>

    {{ $focusKey := .Params.focus_key | default .File.TranslationBaseName }}
    {{ $related := where .Site.RegularPages "Section" "research" }}
    {{ if $focusKey }}
      {{ $related = where $related "Params.focus_areas" "intersect" (slice $focusKey) }}
    {{ else }}
      {{ $topics := .Params.topics | default (slice) }}
      {{ $cats := .Params.categories | default (slice) }}
      {{ if gt (len $cats) 0 }}
        {{ $related = where $related "Params.categories" "intersect" $cats }}
      {{ else if gt (len $topics) 0 }}
        {{ $related = where $related "Params.topics" "intersect" $topics }}
      {{ end }}
    {{ end }}
    {{ $related = first 6 (sort $related "Date" "desc") }}
    {{ if gt (len $related) 0 }}
      <aside aria-label="Related research" style="margin-top:3rem;">
        <h2>Explore Related Research</h2>
        <div class="grid grid-3">
          {{ range $related }}
            {{ partial "cards/research-card.html" . }}
          {{ end }}
        </div>
      </aside>
    {{ end }}
  </div>
</section>
{{ end }}
