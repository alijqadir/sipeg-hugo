{{ define "main" }}
<article class="wrap research-single">
  <header class="research-single__header">
    <h1 class="h1">{{ .Title }}</h1>
    <p class="research-single__meta">
      {{ with .Params.authors }}{{ delimit . ", " }}{{ end }} · {{ .Params.year }}{{ with .Params.topics }} · {{ delimit . ", " }}{{ end }}
    </p>
  </header>

  {{ $cover := or .Params.cover "/images/default-research.png" }}
  {{ with $cover }}
    <figure class="research-single__hero">
      <img src="{{ . }}" alt="" loading="lazy" decoding="async">
    </figure>
  {{ end }}

  {{ with .Params.abstract }}
    <section class="research-single__abstract">
      <h2>Abstract</h2>
      <p>{{ . }}</p>
      {{ $shareUrl := $.Permalink }}
      {{ $shareText := $.Title }}
      <div class="research-share">
        <span class="research-share__label">Download &amp; share</span>
        <div class="research-share__actions">
          {{ with $.Params.pdf }}
            <a class="btn btn-primary btn-sm" href="{{ . }}" target="_blank" rel="noopener">
              <i class="ph ph-file-pdf" aria-hidden="true"></i><span>Download PDF</span>
            </a>
          {{ end }}
          <a class="btn btn-outline btn-share btn-sm" href="https://www.linkedin.com/sharing/share-offsite/?url={{ $shareUrl | urlquery }}" target="_blank" rel="noopener">
            <i class="ph ph-linkedin-logo" aria-hidden="true"></i><span>LinkedIn</span>
          </a>
          <a class="btn btn-outline btn-share btn-sm" href="https://twitter.com/intent/tweet?url={{ $shareUrl | urlquery }}&text={{ $shareText | urlquery }}" target="_blank" rel="noopener">
            <i class="ph ph-twitter-logo" aria-hidden="true"></i><span>X</span>
          </a>
          <button class="btn btn-outline btn-share btn-sm research-share__copy" type="button" data-copy-url="{{ $shareUrl }}">
            <i class="ph ph-link" aria-hidden="true"></i><span>Copy</span>
          </button>
        </div>
      </div>
    </section>
  {{ end }}

  <div class="research-single__body content">
    {{ .Content }}
  </div>

  <div class="research-single__actions">
    {{ with .Params.pdf }}
      <a class="btn btn-primary" href="{{ . }}" target="_blank" rel="noopener">Download PDF</a>
    {{ end }}
    {{ with .Params.doi }}
      {{ if ne . "" }}
        <a class="btn btn-outline" href="{{ . }}" target="_blank" rel="noopener">View DOI</a>
      {{ end }}
    {{ end }}
  </div>

  {{ $shareUrl := .Permalink }}
  {{ $shareText := .Title }}
  <div class="research-share research-share--footer">
    <span class="research-share__label">Share</span>
    <div class="research-share__actions">
      <a class="btn btn-outline btn-share btn-sm" href="https://www.linkedin.com/sharing/share-offsite/?url={{ $shareUrl | urlquery }}" target="_blank" rel="noopener">
        <i class="ph ph-linkedin-logo" aria-hidden="true"></i><span>LinkedIn</span>
      </a>
      <a class="btn btn-outline btn-share btn-sm" href="https://twitter.com/intent/tweet?url={{ $shareUrl | urlquery }}&text={{ $shareText | urlquery }}" target="_blank" rel="noopener">
        <i class="ph ph-twitter-logo" aria-hidden="true"></i><span>X</span>
      </a>
      <button class="btn btn-outline btn-share btn-sm research-share__copy" type="button" data-copy-url="{{ $shareUrl }}">
        <i class="ph ph-link" aria-hidden="true"></i><span>Copy</span>
      </button>
    </div>
  </div>

  {{ with .Params.pdf }}
    <details class="research-single__preview">
      <summary>Preview PDF</summary>
      <object data="{{ . }}" type="application/pdf" width="100%" height="720">
        <p>Your browser can’t display PDFs. <a href="{{ . }}" target="_blank" rel="noopener">Download the PDF</a>.</p>
      </object>
    </details>
  {{ end }}
  {{ partial "comments.html" . }}
</article>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.research-share__copy').forEach((btn) => {
      btn.addEventListener('click', async () => {
        const url = btn.getAttribute('data-copy-url');
        try {
          await navigator.clipboard.writeText(url);
          btn.textContent = 'Copied';
          setTimeout(() => (btn.textContent = 'Copy link'), 2000);
        } catch (e) {
          btn.textContent = 'Failed';
          setTimeout(() => (btn.textContent = 'Copy link'), 2000);
        }
      });
    });
  });
</script>
{{ end }}
